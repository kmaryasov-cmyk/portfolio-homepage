segment_source_task:
  description: |
    Segment the following source text into coherent segments.
    Keep original wording; do not rewrite.

    SOURCE_TEXT:
    {source_text}

    Output requirements:
    - Return valid JSON only (no markdown, no comments).
    - Top-level key: "segments" (array).
    - Each segment item has:
      - "segment_id": string like "S1"
      - "text": exact text span
      - "lang": one of "ru", "en", "mix", "other"
      - "flags": array, allowed values: "ocr", "broken", "placeholder"
  expected_output: |
    Valid JSON with top-level key "segments".
  agent: facts_extractor
  output_file: artifacts/segments.json
  create_directory: true

extract_claims_task:
  description: |
    Using the segmented text from the previous task as the only source,
    extract atomic claims/facts.

    Rules:
    - Do not invent facts.
    - Each claim must have at least 1 evidence quote copied verbatim from a segment.
    - If evidence is missing, set status to "needs_clarification".
    - Allowed statuses: "supported", "needs_clarification", "contradictory", "out_of_scope".

    Output requirements:
    - Return valid JSON only (no markdown, no comments).
    - Top-level key: "claims" (array).
    - Each claim item has:
      - "claim_id": string like "C1"
      - "claim": claim text
      - "status": one of the allowed statuses
      - "evidence": array of items with "segment_id" and "quote"
      - "notes": optional string
  expected_output: |
    Valid JSON with top-level key "claims".
  agent: facts_extractor
  output_file: artifacts/claims.json
  create_directory: true

clarification_questions_task:
  description: |
    From the claims list, generate up to 6 clarification questions that would allow
    upgrading "needs_clarification" claims to "supported".
    If no questions are needed, return an empty questions array.

    Output requirements:
    - Return valid JSON only (no markdown, no comments).
    - Top-level key: "questions" (array).
    - Each question item has:
      - "question_id": string like "Q1"
      - "question": question text
      - "targets": array of claim_ids this question would clarify
  expected_output: |
    Valid JSON with top-level key "questions".
  agent: facts_extractor
  output_file: artifacts/questions.json
  create_directory: true

draft_homepage_task:
  description: |
    Write a Russian portfolio homepage text for a Lead Product Designer.

    Source of truth:
    - Use only claims with status "supported".
    - Do not add any new facts beyond those supported claims.

    Output requirements:
    - Return valid JSON only (no markdown, no comments).
    - Keys:
      - "homepage_md": markdown string
      - "trace_map": array mapping each sentence to claim_ids
    Trace map rules:
    - Each sentence must have:
      - "sentence_id": string like "SENT1"
      - "sentence_text": exact sentence text
      - "claim_ids": array of claim_ids supporting that sentence
    - Every sentence in homepage_md must appear in trace_map.
    - If there are zero supported claims: set homepage_md to empty string.
  expected_output: |
    Valid JSON with keys "homepage_md" and "trace_map".
  agent: homepage_writer
  output_file: artifacts/draft.json
  create_directory: true

final_fact_qa_task:
  description: |
    Validate the draft homepage sentence-by-sentence against trace_map and supported claims.

    Rules:
    - If a sentence is not grounded, remove it or rewrite it without introducing new facts.
    - Keep the final text concise and professional.

    Output requirements:
    - Return valid JSON only (no markdown, no comments).
    - Keys:
      - "homepage_md": final markdown string
      - "trace_map": updated trace_map array
      - "qa_report": object with key "issues" (array)
    Issue item fields:
    - "issue_id": string like "I1"
    - "type": e.g. "ungrounded", "inconsistent_mapping", "missing_evidence"
    - "sentence_id": related sentence id
    - "detail": short explanation
  expected_output: |
    Valid JSON with keys "homepage_md", "trace_map", "qa_report".
  agent: fact_qa
  output_file: artifacts/final.json
  create_directory: true
